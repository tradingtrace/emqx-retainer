%% 100K

(emqx@127.0.0.1)26> emqx_retainer:prepare_test(100000).
2019-06-24 22:06:45.210 [error] dirty_write retainer create, time: 1207715, random: 100518
2019-06-24 22:06:45.743 [error] dirty_write retainer update, time: 532479, count: 100000
2019-06-24 22:11:00.180 [error] dirty_write trie create, time: 254436726, count: 100000
2019-06-24 22:11:01.313 [error] dirty_write trie update, time: 1132915, count: 100000
2019-06-24 22:11:01.313 [error] emqx_retainer, size: 100000, memory: 5184183
2019-06-24 22:11:01.313 [error] emqx_retainer_trie_node, size: 163427, memory: 6779613
2019-06-24 22:11:01.314 [error] emqx_retainer_trie_edge, size: 163426, memory: 3396876
ok
(emqx@127.0.0.1)27> emqx_retainer:test_match().
2019-06-24 22:12:08.861 [error] ---- <<"channel/room_type_9/room_id_7852/#">> ----
2019-06-24 22:12:08.861 [error] foldl matching, ms: 522, time: 521601, topics: 1
2019-06-24 22:12:08.861 [error] select matching, ms: 131, time: 131216, topics: 1
2019-06-24 22:12:08.862 [error] trie matching, ms: 4, time: 3820, topics: 1
2019-06-24 22:12:08.862 [error]
2019-06-24 22:12:10.117 [error] ---- <<"channel/+/+/measure_4">> ----
2019-06-24 22:12:10.117 [error] foldl matching, ms: 832, time: 831986, topics: 1007
2019-06-24 22:12:10.118 [error] select matching, ms: 133, time: 133480, topics: 1007
2019-06-24 22:12:10.118 [error] trie matching, ms: 290, time: 290050, topics: 1007
2019-06-24 22:12:10.118 [error]
2019-06-24 22:12:11.223 [error] ---- <<"channel/room_type_9/#">> ----
2019-06-24 22:12:11.224 [error] foldl matching, ms: 886, time: 886297, topics: 10137
2019-06-24 22:12:11.224 [error] select matching, ms: 147, time: 147077, topics: 10137
2019-06-24 22:12:11.224 [error] trie matching, ms: 72, time: 72039, topics: 10137
2019-06-24 22:12:11.224 [error]
2019-06-24 22:12:14.104 [error] ---- <<"channel/#">> ----
2019-06-24 22:12:14.104 [error] foldl matching, ms: 1544, time: 1543402, topics: 99997
2019-06-24 22:12:14.105 [error] select matching, ms: 335, time: 335234, topics: 99997
2019-06-24 22:12:14.105 [error] trie matching, ms: 1001, time: 1001149, topics: 99997
2019-06-24 22:12:14.105 [error]
2019-06-24 22:12:16.934 [error] ---- <<"#">> ----
2019-06-24 22:12:16.934 [error] foldl matching, ms: 1497, time: 1497029, topics: 99997
2019-06-24 22:12:16.934 [error] select matching, ms: 365, time: 365080, topics: 99997
2019-06-24 22:12:16.934 [error] trie matching, ms: 967, time: 966293, topics: 100000
2019-06-24 22:12:16.935 [error]
2019-06-24 22:12:17.908 [error] ---- <<"+">> ----
2019-06-24 22:12:17.908 [error] foldl matching, ms: 795, time: 795061, topics: 0
2019-06-24 22:12:17.908 [error] select matching, ms: 178, time: 177718, topics: 0
2019-06-24 22:12:17.909 [error] trie matching, ms: 0, time: 35, topics: 0
2019-06-24 22:12:17.909 [error]
2019-06-24 22:12:18.877 [error] ---- <<"+/+">> ----
2019-06-24 22:12:18.877 [error] foldl matching, ms: 803, time: 802586, topics: 0
2019-06-24 22:12:18.877 [error] select matching, ms: 165, time: 164975, topics: 0
2019-06-24 22:12:18.877 [error] trie matching, ms: 0, time: 64, topics: 1
2019-06-24 22:12:18.878 [error]
2019-06-24 22:12:19.874 [error] ---- <<"$SYS/#">> ----
2019-06-24 22:12:19.875 [error] foldl matching, ms: 822, time: 821997, topics: 3
2019-06-24 22:12:19.875 [error] select matching, ms: 174, time: 174448, topics: 3
2019-06-24 22:12:19.875 [error] trie matching, ms: 0, time: 59, topics: 3
2019-06-24 22:12:19.875 [error]
ok

----------------------------------------------------------------------------------------------------------------------
%% 500K

(emqx@127.0.0.1)172> emqx_retainer:prepare_test(500000).
2019-06-24 19:50:43.485 [error] dirty_write retainer create, time: 11110249, random: 512949
2019-06-24 20:20:35.520 [error] dirty_write retainer update, time: 10343324, count: 500000
2019-06-24 20:20:35.521 [error] dirty_write trie create, time: 1774255361, count: 500000
2019-06-24 20:20:35.521 [error] dirty_write trie update, time: 7429711, count: 500000
2019-06-24 20:45:03.964 [error] emqx_retainer, size: 500000, memory: 25414184
2019-06-24 20:45:03.964 [error] emqx_retainer_trie_node, size: 599409, memory: 30189099
2019-06-24 20:45:03.964 [error] emqx_retainer_trie_edge, size: 599408, memory: 12521915
ok

(emqx@127.0.0.1)177> emqx_retainer:test_match().
2019-06-24 20:30:21.931 [error] ---- <<"channel/room_type_1/room_id_6333/#">> ----
2019-06-24 20:30:21.932 [error] foldl matching, ms: 3075, time: 3074843, topics: 2
2019-06-24 20:30:21.932 [error] select matching, ms: 695, time: 694888, topics: 2
2019-06-24 20:30:21.932 [error] trie matching, ms: 7, time: 7245, topics: 2
2019-06-24 20:30:21.932 [error]
2019-06-24 20:30:26.994 [error] ---- <<"channel/+/+/measure_20">> ----
2019-06-24 20:30:26.994 [error] foldl matching, ms: 3762, time: 3762092, topics: 4926
2019-06-24 20:30:26.994 [error] select matching, ms: 700, time: 699473, topics: 4926
2019-06-24 20:30:26.994 [error] trie matching, ms: 600, time: 600266, topics: 4926
2019-06-24 20:30:26.994 [error]
2019-06-24 20:30:32.583 [error] ---- <<"channel/room_type_1/#">> ----
2019-06-24 20:30:32.583 [error] foldl matching, ms: 4591, time: 4591181, topics: 50170
2019-06-24 20:30:32.583 [error] select matching, ms: 724, time: 723068, topics: 50170
2019-06-24 20:30:32.583 [error] trie matching, ms: 274, time: 274411, topics: 50170
2019-06-24 20:30:32.584 [error]
2019-06-24 20:30:45.181 [error] ---- <<"channel/#">> ----
2019-06-24 20:30:45.182 [error] foldl matching, ms: 7666, time: 7666708, topics: 499997
2019-06-24 20:30:45.182 [error] select matching, ms: 1136, time: 1135125, topics: 499997
2019-06-24 20:30:45.182 [error] trie matching, ms: 3795, time: 3795808, topics: 499997
2019-06-24 20:30:45.182 [error]
2019-06-24 20:30:54.628 [error] ---- <<"#">> ----
2019-06-24 20:30:54.628 [error] foldl matching, ms: 5582, time: 5581660, topics: 499997
2019-06-24 20:30:54.628 [error] select matching, ms: 1249, time: 1248936, topics: 499997
2019-06-24 20:30:54.628 [error] trie matching, ms: 2615, time: 2615258, topics: 500000
2019-06-24 20:30:54.628 [error]
2019-06-24 20:30:57.949 [error] ---- <<"+">> ----
2019-06-24 20:30:57.950 [error] foldl matching, ms: 2692, time: 2692616, topics: 0
2019-06-24 20:30:57.950 [error] select matching, ms: 628, time: 628211, topics: 0
2019-06-24 20:30:57.950 [error] trie matching, ms: 0, time: 29, topics: 0
2019-06-24 20:30:57.950 [error]
2019-06-24 20:31:01.226 [error] ---- <<"+/+">> ----
2019-06-24 20:31:01.226 [error] foldl matching, ms: 2641, time: 2641019, topics: 0
2019-06-24 20:31:01.226 [error] select matching, ms: 635, time: 634901, topics: 0
2019-06-24 20:31:01.226 [error] trie matching, ms: 0, time: 48, topics: 1
2019-06-24 20:31:01.227 [error]
2019-06-24 20:31:04.581 [error] ---- <<"$SYS/#">> ----
2019-06-24 20:31:04.581 [error] foldl matching, ms: 2687, time: 2687587, topics: 3
2019-06-24 20:31:04.581 [error] select matching, ms: 667, time: 666366, topics: 3
2019-06-24 20:31:04.581 [error] trie matching, ms: 0, time: 45, topics: 3
2019-06-24 20:31:04.581 [error]
ok
